{% extends "jobs/admin_templates/base.html" %}
{% load static %}

{% block title %}Order Management | Venex Trading Platform{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'assets/css/order.css' %}">
{% endblock %}

{% block main_content %}
<div class="orders-container">
    <!-- Hero Section -->
    <div class="orders-hero-section">
        <div class="hero-content">
            <div class="hero-header">
                <div class="hero-text">
                    <h1>
                        <i class="fas fa-list-alt"></i>
                        Order Management
                    </h1>
                    <p>Create and manage your trading orders with advanced order types</p>
                </div>
                <div class="hero-actions">
                    <button class="btn-hero-action" id="create-order-btn">
                        <i class="fas fa-plus-circle"></i>
                        Create Order
                    </button>
                    <button class="btn-hero-action secondary" id="refresh-orders-btn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="order-stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Open Orders</div>
                        <div class="stat-value" id="open-orders-count">0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon success">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Filled Today</div>
                        <div class="stat-value" id="filled-today-count">0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon warning">
                        <i class="fas fa-adjust"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Partially Filled</div>
                        <div class="stat-value" id="partial-orders-count">0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon info">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Total Volume</div>
                        <div class="stat-value" id="total-order-volume">$0.00</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="orders-content">
        <!-- Filters Bar -->
        <div class="filters-bar">
            <div class="filters-group">
                <div class="filter-item">
                    <label class="filter-label">
                        <i class="fas fa-filter"></i>
                        Order Type
                    </label>
                    <select id="order-type-filter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="MARKET">Market</option>
                        <option value="LIMIT">Limit</option>
                        <option value="STOP_LOSS">Stop Loss</option>
                        <option value="TAKE_PROFIT">Take Profit</option>
                    </select>
                </div>

                <div class="filter-item">
                    <label class="filter-label">
                        <i class="fas fa-exchange-alt"></i>
                        Side
                    </label>
                    <select id="side-filter" class="filter-select">
                        <option value="">All Sides</option>
                        <option value="BUY">Buy</option>
                        <option value="SELL">Sell</option>
                    </select>
                </div>

                <div class="filter-item">
                    <label class="filter-label">
                        <i class="fas fa-coins"></i>
                        Cryptocurrency
                    </label>
                    <select id="crypto-filter" class="filter-select">
                        <option value="">All Crypto</option>
                        <option value="BTC">Bitcoin (BTC)</option>
                        <option value="ETH">Ethereum (ETH)</option>
                        <option value="USDT">Tether (USDT)</option>
                        <option value="LTC">Litecoin (LTC)</option>
                        <option value="TRX">Tron (TRX)</option>
                    </select>
                </div>

                <div class="filter-item">
                    <label class="filter-label">
                        <i class="fas fa-tags"></i>
                        Status
                    </label>
                    <select id="status-filter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="OPEN">Open</option>
                        <option value="PARTIALLY_FILLED">Partially Filled</option>
                        <option value="FILLED">Filled</option>
                        <option value="CANCELLED">Cancelled</option>
                    </select>
                </div>

                <button class="btn-clear-filters" id="clear-filters">
                    <i class="fas fa-times"></i>
                    Clear
                </button>
            </div>
        </div>

        <!-- Orders Grid -->
        <div class="orders-grid" id="orders-grid">
            <div class="loading-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading orders...</p>
            </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="empty-state" style="display: none;">
            <i class="fas fa-inbox"></i>
            <h3>No Orders Found</h3>
            <p>You haven't placed any orders yet. Create your first order to get started!</p>
            <button class="btn-primary" onclick="showCreateOrderModal()">
                <i class="fas fa-plus"></i>
                Create Order
            </button>
        </div>
    </div>
</div>

<!-- Create Order Modal -->
<div class="modal fade" id="createOrderModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-plus-circle"></i>
                    Create New Order
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="create-order-form">
                    {% csrf_token %}
                    
                    <!-- Order Type Selection -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-list"></i>
                            Order Type
                        </label>
                        <div class="order-type-selector">
                            <label class="order-type-option">
                                <input type="radio" name="order_type" value="MARKET" checked>
                                <span class="option-card">
                                    <i class="fas fa-bolt"></i>
                                    <strong>Market</strong>
                                    <small>Execute immediately at market price</small>
                                </span>
                            </label>
                            <label class="order-type-option">
                                <input type="radio" name="order_type" value="LIMIT">
                                <span class="option-card">
                                    <i class="fas fa-crosshairs"></i>
                                    <strong>Limit</strong>
                                    <small>Execute at specific price or better</small>
                                </span>
                            </label>
                            <label class="order-type-option">
                                <input type="radio" name="order_type" value="STOP_LOSS">
                                <span class="option-card">
                                    <i class="fas fa-shield-alt"></i>
                                    <strong>Stop Loss</strong>
                                    <small>Sell when price drops to limit losses</small>
                                </span>
                            </label>
                            <label class="order-type-option">
                                <input type="radio" name="order_type" value="TAKE_PROFIT">
                                <span class="option-card">
                                    <i class="fas fa-bullseye"></i>
                                    <strong>Take Profit</strong>
                                    <small>Sell when price reaches target</small>
                                </span>
                            </label>
                        </div>
                    </div>

                    <!-- Side Selection -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-exchange-alt"></i>
                            Side
                        </label>
                        <div class="side-selector">
                            <label class="side-option buy">
                                <input type="radio" name="side" value="BUY" checked>
                                <span class="side-card">
                                    <i class="fas fa-arrow-up"></i>
                                    <strong>Buy</strong>
                                </span>
                            </label>
                            <label class="side-option sell">
                                <input type="radio" name="side" value="SELL">
                                <span class="side-card">
                                    <i class="fas fa-arrow-down"></i>
                                    <strong>Sell</strong>
                                </span>
                            </label>
                        </div>
                    </div>

                    <!-- Cryptocurrency -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-coins"></i>
                            Cryptocurrency
                        </label>
                        <select name="cryptocurrency" class="form-control" required>
                            <option value="">Select cryptocurrency</option>
                            <option value="BTC">Bitcoin (BTC)</option>
                            <option value="ETH">Ethereum (ETH)</option>
                            <option value="USDT">Tether (USDT)</option>
                            <option value="LTC">Litecoin (LTC)</option>
                            <option value="TRX">Tron (TRX)</option>
                        </select>
                        <div class="current-price-display" id="current-price-display">
                            Current Price: <span id="current-price-value">-</span>
                        </div>
                    </div>

                    <!-- Quantity -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-calculator"></i>
                            Quantity
                        </label>
                        <div class="input-group">
                            <input type="number" 
                                   name="quantity" 
                                   class="form-control" 
                                   placeholder="0.00000000" 
                                   step="0.00000001" 
                                   min="0.00000001" 
                                   required>
                            <span class="input-addon" id="quantity-symbol">CRYPTO</span>
                        </div>
                        <div class="balance-display">
                            Available: <span id="available-balance">0.00000000</span>
                        </div>
                    </div>

                    <!-- Price (for LIMIT orders) -->
                    <div class="form-group" id="price-group" style="display: none;">
                        <label class="form-label">
                            <i class="fas fa-dollar-sign"></i>
                            Limit Price
                        </label>
                        <div class="input-group">
                            <span class="input-addon">$</span>
                            <input type="number" 
                                   name="price" 
                                   class="form-control" 
                                   placeholder="0.00" 
                                   step="0.01" 
                                   min="0.01">
                        </div>
                        <small class="form-hint">Order will execute when market reaches this price</small>
                    </div>

                    <!-- Stop Price (for STOP orders) -->
                    <div class="form-group" id="stop-price-group" style="display: none;">
                        <label class="form-label">
                            <i class="fas fa-hand-paper"></i>
                            Stop Price
                        </label>
                        <div class="input-group">
                            <span class="input-addon">$</span>
                            <input type="number" 
                                   name="stop_price" 
                                   class="form-control" 
                                   placeholder="0.00" 
                                   step="0.01" 
                                   min="0.01">
                        </div>
                        <small class="form-hint">Order triggers when market reaches this price</small>
                    </div>

                    <!-- Time in Force -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-clock"></i>
                            Time in Force
                        </label>
                        <select name="time_in_force" class="form-control">
                            <option value="GTC">Good Till Cancelled (GTC)</option>
                            <option value="IOC">Immediate or Cancel (IOC)</option>
                            <option value="FOK">Fill or Kill (FOK)</option>
                            <option value="DAY">Day Order</option>
                        </select>
                    </div>

                    <!-- Order Summary -->
                    <div class="order-summary">
                        <h6><i class="fas fa-receipt"></i> Order Summary</h6>
                        <div class="summary-row">
                            <span>Order Type:</span>
                            <span id="summary-type">Market</span>
                        </div>
                        <div class="summary-row">
                            <span>Side:</span>
                            <span id="summary-side">Buy</span>
                        </div>
                        <div class="summary-row">
                            <span>Quantity:</span>
                            <span id="summary-quantity">0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Estimated Total:</span>
                            <span id="summary-total" class="highlight">$0.00</span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="submit-order-btn">
                    <i class="fas fa-check-circle"></i>
                    Place Order
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Order Details Modal -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-file-alt"></i>
                    Order Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="order-details-content">
                <!-- Content loaded dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger" id="cancel-order-btn" style="display: none;">
                    <i class="fas fa-times-circle"></i>
                    Cancel Order
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'assets/js/tradingSocket.js' %}"></script>
<script src="{% static 'assets/js/order.js' %}"></script>
{% endblock %}