{% extends "jobs/admin_templates/base.html" %}
{% load static %}

{% block title %}User Profile | Venex Trading Platform{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'assets/css/profile.css' %}">
{% endblock %}

{% block main_content %}
<div class="profile-container">
    <!-- Page Header -->
    <div class="profile-hero-section">
        <div class="hero-content">
            <div class="hero-header">
                <div class="hero-text">
                    <h1>
                        <i class="fas fa-user-circle"></i>
                        My Profile
                    </h1>
                    <p>Manage your account information and security settings</p>
                </div>
                <div class="hero-actions">
                    <button class="btn-save-all" id="save-all-btn" style="display: none;">
                        <i class="fas fa-save"></i>
                        Save All Changes
                    </button>
                </div>
            </div>

            <!-- Profile Stats -->
            <div class="profile-stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Account Status</div>
                        <div class="stat-value" id="account-status">
                            {% if user.is_verified %}
                            <span class="status-badge verified">Verified</span>
                            {% else %}
                            <span class="status-badge pending">Unverified</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon info">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Security Level</div>
                        <div class="stat-value">
                            <span class="security-level">Medium</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon success">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Wallet Addresses</div>
                        <div class="stat-value" id="wallet-count">0</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon warning">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Member Since</div>
                        <div class="stat-value">{{ user.created_at|date:"M Y" }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="profile-content">
        <!-- Tabs Navigation -->
        <div class="tabs-container">
            <div class="tabs-nav">
                <button class="tab-btn active" data-tab="personal">
                    <i class="fas fa-user"></i>
                    Personal Info
                </button>
                <button class="tab-btn" data-tab="kyc">
                    <i class="fas fa-id-card"></i>
                    KYC Verification
                </button>
                <button class="tab-btn" data-tab="security">
                    <i class="fas fa-lock"></i>
                    Security
                </button>
                <button class="tab-btn" data-tab="wallets">
                    <i class="fas fa-wallet"></i>
                    Wallet Addresses
                </button>
            </div>
        </div>

        <!-- Tab Content: Personal Info -->
        <div class="tab-content active" id="personal-tab">
            <div class="content-card">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-user"></i>
                        Personal Information
                    </h3>
                    <button class="btn-edit" id="edit-personal-btn">
                        <i class="fas fa-edit"></i>
                        Edit
                    </button>
                </div>
                <div class="card-body">
                    <form id="personal-info-form">
                        <div class="form-grid">
                            <!-- Profile Picture -->
                            <div class="form-group full-width">
                                <div class="profile-picture-section">
                                    <div class="profile-pic-wrapper">
                                        <div class="profile-pic" id="profile-pic-display">
                                            {% if user.profile_pic %}
                                            <img src="{{ user.profile_pic.url }}" alt="Profile">
                                            {% else %}
                                            <i class="fas fa-user"></i>
                                            {% endif %}
                                        </div>
                                        <button type="button" class="btn-change-pic" id="change-pic-btn">
                                            <i class="fas fa-camera"></i>
                                        </button>
                                        <input type="file" id="profile-pic-input" accept="image/*" style="display: none;">
                                    </div>
                                    <div class="profile-pic-info">
                                        <h4>{{ user.full_name }}</h4>
                                        <p>{{ user.email }}</p>
                                        <small>Joined {{ user.created_at|date:"F d, Y" }}</small>
                                    </div>
                                </div>
                            </div>

                            <!-- First Name -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user"></i>
                                    First Name
                                </label>
                                <input type="text" 
                                       id="first-name" 
                                       class="form-input" 
                                       value="{{ user.first_name }}"
                                       disabled>
                            </div>

                            <!-- Last Name -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user"></i>
                                    Last Name
                                </label>
                                <input type="text" 
                                       id="last-name" 
                                       class="form-input" 
                                       value="{{ user.last_name }}"
                                       disabled>
                            </div>

                            <!-- Username -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-at"></i>
                                    Username
                                </label>
                                <input type="text" 
                                       id="username" 
                                       class="form-input" 
                                       value="{{ user.username }}"
                                       disabled>
                            </div>

                            <!-- Email -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-envelope"></i>
                                    Email Address
                                </label>
                                <input type="email" 
                                       id="email" 
                                       class="form-input" 
                                       value="{{ user.email }}"
                                       disabled>
                            </div>

                            <!-- Phone -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-phone"></i>
                                    Phone Number
                                </label>
                                <input type="tel" 
                                       id="phone" 
                                       class="form-input" 
                                       value="{{ user.phone_no|default:'' }}"
                                       placeholder="+1 (555) 123-4567"
                                       disabled>
                            </div>

                            <!-- Gender -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-venus-mars"></i>
                                    Gender
                                </label>
                                <select id="gender" class="form-select" disabled>
                                    <option value="">Select Gender</option>
                                    <option value="M" {% if user.gender == 'M' %}selected{% endif %}>Male</option>
                                    <option value="F" {% if user.gender == 'F' %}selected{% endif %}>Female</option>
                                    <option value="O" {% if user.gender == 'O' %}selected{% endif %}>Other</option>
                                </select>
                            </div>

                            <!-- Country -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-globe"></i>
                                    Country
                                </label>
                                <input type="text" 
                                       id="country" 
                                       class="form-input" 
                                       value="{{ user.country.name|default:'' }}"
                                       disabled>
                            </div>

                            <!-- State -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-map-marker-alt"></i>
                                    State/Province
                                </label>
                                <input type="text" 
                                       id="state" 
                                       class="form-input" 
                                       value="{{ user.state.name|default:'' }}"
                                       disabled>
                            </div>

                            <!-- Address -->
                            <div class="form-group full-width">
                                <label class="form-label">
                                    <i class="fas fa-home"></i>
                                    Address
                                </label>
                                <textarea id="address" 
                                          class="form-textarea" 
                                          rows="3"
                                          placeholder="Enter your full address"
                                          disabled>{{ user.address|default:'' }}</textarea>
                            </div>
                        </div>

                        <div class="form-actions" style="display: none;">
                            <button type="button" class="btn-cancel" id="cancel-personal-btn">
                                <i class="fas fa-times"></i>
                                Cancel
                            </button>
                            <button type="submit" class="btn-save">
                                <i class="fas fa-save"></i>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Tab Content: KYC Verification -->
        <div class="tab-content" id="kyc-tab">
            <div class="content-card">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-id-card"></i>
                        KYC Verification
                    </h3>
                    <div class="verification-status">
                        {% if user.is_verified %}
                        <span class="status-badge verified">
                            <i class="fas fa-check-circle"></i>
                            Verified
                        </span>
                        {% else %}
                        <span class="status-badge pending">
                            <i class="fas fa-clock"></i>
                            Not Verified
                        </span>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                    {% if not user.is_verified %}
                    <div class="kyc-info-box">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h4>Complete your KYC verification</h4>
                            <p>To enjoy full trading capabilities and higher limits, please complete your KYC verification by uploading a valid government-issued ID.</p>
                        </div>
                    </div>

                    <form id="kyc-form" enctype="multipart/form-data">
                        <div class="kyc-upload-section">
                            <div class="upload-area" id="kyc-upload-area">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <h4>Upload Identity Document</h4>
                                <p>Drag and drop your document here, or click to browse</p>
                                <small>Accepted formats: JPG, PNG, PDF (Max 5MB)</small>
                                <input type="file" 
                                       id="kyc-document" 
                                       name="id_document"
                                       accept=".jpg,.jpeg,.png,.pdf"
                                       style="display: none;">
                                <button type="button" class="btn-browse" onclick="document.getElementById('kyc-document').click();">
                                    <i class="fas fa-folder-open"></i>
                                    Browse Files
                                </button>
                            </div>

                            <div class="uploaded-file-preview" id="file-preview" style="display: none;">
                                <div class="file-info">
                                    <i class="fas fa-file-alt"></i>
                                    <div>
                                        <h5 id="file-name"></h5>
                                        <small id="file-size"></small>
                                    </div>
                                </div>
                                <button type="button" class="btn-remove" id="remove-file-btn">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>

                        <div class="kyc-document-types">
                            <h4>Accepted Documents</h4>
                            <div class="document-types-grid">
                                <div class="document-type">
                                    <i class="fas fa-passport"></i>
                                    <span>Passport</span>
                                </div>
                                <div class="document-type">
                                    <i class="fas fa-id-card"></i>
                                    <span>National ID</span>
                                </div>
                                <div class="document-type">
                                    <i class="fas fa-car"></i>
                                    <span>Driver's License</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-submit-kyc">
                                <i class="fas fa-paper-plane"></i>
                                Submit for Verification
                            </button>
                        </div>
                    </form>
                    {% else %}
                    <div class="kyc-verified-section">
                        <div class="verified-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3>Your account is verified!</h3>
                        <p>You completed KYC verification on {{ user.verification_date|date:"F d, Y" }}</p>
                        
                        {% if user.id_document %}
                        <div class="verified-document">
                            <i class="fas fa-file-alt"></i>
                            <span>Document on file</span>
                            <a href="{{ user.id_document.url }}" target="_blank" class="btn-view">
                                <i class="fas fa-eye"></i>
                                View
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Tab Content: Security -->
        <div class="tab-content" id="security-tab">
            <div class="content-card">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-lock"></i>
                        Security Settings
                    </h3>
                </div>
                <div class="card-body">
                    <!-- Change Password Section -->
                    <div class="security-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-key"></i>
                                <h4>Change Password</h4>
                            </div>
                            <p>Update your password regularly to keep your account secure</p>
                        </div>

                        <form id="password-form">
                            <div class="form-grid">
                                <div class="form-group full-width">
                                    <label class="form-label">
                                        <i class="fas fa-lock"></i>
                                        Current Password
                                    </label>
                                    <div class="password-input-wrapper">
                                        <input type="password" 
                                               id="current-password" 
                                               class="form-input" 
                                               placeholder="Enter current password"
                                               required>
                                        <button type="button" class="btn-toggle-password" data-target="current-password">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="form-group full-width">
                                    <label class="form-label">
                                        <i class="fas fa-lock"></i>
                                        New Password
                                    </label>
                                    <div class="password-input-wrapper">
                                        <input type="password" 
                                               id="new-password" 
                                               class="form-input" 
                                               placeholder="Enter new password"
                                               required>
                                        <button type="button" class="btn-toggle-password" data-target="new-password">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="password-strength" id="password-strength">
                                        <div class="strength-bar">
                                            <div class="strength-fill" id="strength-fill"></div>
                                        </div>
                                        <small id="strength-text">Password strength: <span>Weak</span></small>
                                    </div>
                                </div>

                                <div class="form-group full-width">
                                    <label class="form-label">
                                        <i class="fas fa-lock"></i>
                                        Confirm New Password
                                    </label>
                                    <div class="password-input-wrapper">
                                        <input type="password" 
                                               id="confirm-password" 
                                               class="form-input" 
                                               placeholder="Confirm new password"
                                               required>
                                        <button type="button" class="btn-toggle-password" data-target="confirm-password">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="password-requirements">
                                <h5>Password Requirements:</h5>
                                <ul>
                                    <li id="req-length">
                                        <i class="fas fa-circle"></i>
                                        At least 8 characters
                                    </li>
                                    <li id="req-uppercase">
                                        <i class="fas fa-circle"></i>
                                        One uppercase letter
                                    </li>
                                    <li id="req-lowercase">
                                        <i class="fas fa-circle"></i>
                                        One lowercase letter
                                    </li>
                                    <li id="req-number">
                                        <i class="fas fa-circle"></i>
                                        One number
                                    </li>
                                    <li id="req-special">
                                        <i class="fas fa-circle"></i>
                                        One special character
                                    </li>
                                </ul>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn-save">
                                    <i class="fas fa-key"></i>
                                    Update Password
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="divider"></div>

                    <!-- Two-Factor Authentication Section -->
                    <div class="security-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-mobile-alt"></i>
                                <h4>Two-Factor Authentication (2FA)</h4>
                            </div>
                            <p>Add an extra layer of security to your account</p>
                        </div>

                        <div class="tfa-status">
                            <div class="status-info">
                                <i class="fas fa-shield-alt"></i>
                                <div>
                                    <h5>2FA Status: <span class="status-badge warning">Disabled</span></h5>
                                    <p>Protect your account with two-factor authentication</p>
                                </div>
                            </div>
                            <button class="btn-enable-2fa">
                                <i class="fas fa-plus-circle"></i>
                                Enable 2FA
                            </button>
                        </div>

                        <div class="tfa-benefits">
                            <h5>Benefits of 2FA:</h5>
                            <div class="benefits-grid">
                                <div class="benefit-item">
                                    <i class="fas fa-check"></i>
                                    <span>Enhanced account security</span>
                                </div>
                                <div class="benefit-item">
                                    <i class="fas fa-check"></i>
                                    <span>Protection against unauthorized access</span>
                                </div>
                                <div class="benefit-item">
                                    <i class="fas fa-check"></i>
                                    <span>Real-time security alerts</span>
                                </div>
                                <div class="benefit-item">
                                    <i class="fas fa-check"></i>
                                    <span>Industry-standard protection</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <!-- Login History Section -->
                    <div class="security-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-history"></i>
                                <h4>Recent Login Activity</h4>
                            </div>
                            <p>Monitor recent access to your account</p>
                        </div>

                        <div class="login-history-list">
                            <div class="login-item">
                                <div class="login-icon">
                                    <i class="fas fa-desktop"></i>
                                </div>
                                <div class="login-info">
                                    <h5>Web Browser - Chrome</h5>
                                    <p>{{ user.last_login|date:"F d, Y - h:i A" }}</p>
                                    <small>IP: 192.168.1.1 • Location: Current Session</small>
                                </div>
                                <span class="current-badge">Current</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Wallet Addresses -->
        <div class="tab-content" id="wallets-tab">
            <div class="content-card">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-wallet"></i>
                        Wallet Addresses
                    </h3>
                    <button class="btn-edit" id="edit-wallets-btn">
                        <i class="fas fa-edit"></i>
                        Edit
                    </button>
                </div>
                <div class="card-body">
                    <div class="wallets-info-box">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h4>Manage Your Crypto Wallets</h4>
                            <p>Add your cryptocurrency wallet addresses to receive deposits and withdrawals</p>
                        </div>
                    </div>

                    <form id="wallets-form">
                        <div class="wallets-grid">
                            <!-- Bitcoin Wallet -->
                            <div class="wallet-card">
                                <div class="wallet-header">
                                    <div class="wallet-icon btc">
                                        <i class="fab fa-bitcoin"></i>
                                    </div>
                                    <div class="wallet-title">
                                        <h4>Bitcoin (BTC)</h4>
                                        <p>Balance: {{ user.btc_balance }} BTC</p>
                                    </div>
                                </div>
                                <div class="wallet-address-group">
                                    <label class="form-label">Wallet Address</label>
                                    <div class="address-input-wrapper">
                                        <input type="text" 
                                               id="btc-wallet" 
                                               class="form-input wallet-input" 
                                               value="{{ user.btc_wallet|default:'' }}"
                                               placeholder="Enter Bitcoin wallet address"
                                               disabled>
                                        <button type="button" class="btn-copy" data-wallet="btc">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Ethereum Wallet -->
                            <div class="wallet-card">
                                <div class="wallet-header">
                                    <div class="wallet-icon eth">
                                        <i class="fab fa-ethereum"></i>
                                    </div>
                                    <div class="wallet-title">
                                        <h4>Ethereum (ETH)</h4>
                                        <p>Balance: {{ user.ethereum_balance }} ETH</p>
                                    </div>
                                </div>
                                <div class="wallet-address-group">
                                    <label class="form-label">Wallet Address</label>
                                    <div class="address-input-wrapper">
                                        <input type="text" 
                                               id="ethereum-wallet" 
                                               class="form-input wallet-input" 
                                               value="{{ user.ethereum_wallet|default:'' }}"
                                               placeholder="Enter Ethereum wallet address"
                                               disabled>
                                        <button type="button" class="btn-copy" data-wallet="eth">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- USDT Wallet -->
                            <div class="wallet-card">
                                <div class="wallet-header">
                                    <div class="wallet-icon usdt">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                    <div class="wallet-title">
                                        <h4>Tether (USDT)</h4>
                                        <p>Balance: {{ user.usdt_balance }} USDT</p>
                                    </div>
                                </div>
                                <div class="wallet-address-group">
                                    <label class="form-label">Wallet Address</label>
                                    <div class="address-input-wrapper">
                                        <input type="text" 
                                               id="usdt-wallet" 
                                               class="form-input wallet-input" 
                                               value="{{ user.usdt_wallet|default:'' }}"
                                               placeholder="Enter USDT wallet address"
                                               disabled>
                                        <button type="button" class="btn-copy" data-wallet="usdt">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Litecoin Wallet -->
                            <div class="wallet-card">
                                <div class="wallet-header">
                                    <div class="wallet-icon ltc">
                                        <i class="fas fa-coins"></i>
                                    </div>
                                    <div class="wallet-title">
                                        <h4>Litecoin (LTC)</h4>
                                        <p>Balance: {{ user.litecoin_balance }} LTC</p>
                                    </div>
                                </div>
                                <div class="wallet-address-group">
                                    <label class="form-label">Wallet Address</label>
                                    <div class="address-input-wrapper">
                                        <input type="text" 
                                               id="litecoin-wallet" 
                                               class="form-input wallet-input" 
                                               value="{{ user.litecoin_wallet|default:'' }}"
                                               placeholder="Enter Litecoin wallet address"
                                               disabled>
                                        <button type="button" class="btn-copy" data-wallet="ltc">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Tron Wallet -->
                            <div class="wallet-card">
                                <div class="wallet-header">
                                    <div class="wallet-icon trx">
                                        <i class="fas fa-gem"></i>
                                    </div>
                                    <div class="wallet-title">
                                        <h4>Tron (TRX)</h4>
                                        <p>Balance: {{ user.tron_balance }} TRX</p>
                                    </div>
                                </div>
                                <div class="wallet-address-group">
                                    <label class="form-label">Wallet Address</label>
                                    <div class="address-input-wrapper">
                                        <input type="text" 
                                               id="tron-wallet" 
                                               class="form-input wallet-input" 
                                               value="{{ user.tron_wallet|default:'' }}"
                                               placeholder="Enter Tron wallet address"
                                               disabled>
                                        <button type="button" class="btn-copy" data-wallet="trx">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions" style="display: none;">
                            <button type="button" class="btn-cancel" id="cancel-wallets-btn">
                                <i class="fas fa-times"></i>
                                Cancel
                            </button>
                            <button type="submit" class="btn-save">
                                <i class="fas fa-save"></i>
                                Save Wallet Addresses
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div class="toast" id="toast">
    <div class="toast-content">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Action completed successfully</span>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'assets/js/profile.js' %}"></script>
{% endblock %}
