{% extends 'jobs/base.html' %}
{% load static %}
{% block title %}Signup With Venex LTD{% endblock %}
{% block meta_keywords %} venex signup {% endblock %}
{% block meta_description %}sign up with venex {% endblock %}

{% block content %}
<script src="{% static 'assets/js/coingecko-coin-market-ticker-list-widget.js' %}"></script>
<coingecko-coin-market-ticker-list-widget coin-id="bitcoin" currency="usd" locale="en" vce-ready=""></coingecko-coin-market-ticker-list-widget>

<div class="form-container-wrap">
    <div class="form-container signuppage">
        <h3>Create a New Account</h3>

        <!-- Messages Display Area -->
        <div id="message-alerts" style="display: none;"></div>

        <script language="javascript">
            function checkform() {
                // Basic validation
                if (document.regform.first_name.value == '') {
                    alert("Please enter your first name!");
                    document.regform.first_name.focus();
                    return false;
                }
                if (document.regform.last_name.value == '') {
                    alert("Please enter your last name!");
                    document.regform.last_name.focus();
                    return false;
                }
                if (document.regform.username.value == '') {
                    alert("Please enter your username!");
                    document.regform.username.focus();
                    return false;
                }
                if (!document.regform.username.value.match(/^[A-Za-z0-9_\-]+$/)) {
                    alert("For username you should use English letters and digits only!");
                    document.regform.username.focus();
                    return false;
                }
                if (document.regform.password.value == '') {
                    alert("Please enter your password!");
                    document.regform.password.focus();
                    return false;
                }
                if (document.regform.password.value != document.regform.password_confirm.value) {
                    alert("Please check your password - they are not identical!");
                    document.regform.password_confirm.focus();
                    return false;
                }
                if (document.regform.email.value == '') {
                    alert("Please enter your e-mail address!");
                    document.regform.email.focus();
                    return false;
                }
                if (document.regform.country.value == '') {
                    alert("Please select your country!");
                    document.regform.country.focus();
                    return false;
                }
                if (document.regform.state.value == '') {
                    alert("Please select your state!");
                    document.regform.state.focus();
                    return false;
                }
                if (document.regform.currency_type.value == '') {
                    alert("Please select your currency!");
                    document.regform.currency_type.focus();
                    return false;
                }
                if (document.regform.agree_terms.checked == false) {
                    alert("You have to agree with the Terms and Conditions!");
                    return false;
                }
                return true;
            }

            // AJAX for loading states based on country selection
            $(document).ready(function() {
                // Show Django messages as jQuery notifications
                {% if messages %}
                    {% for message in messages %}
                        {% if message.tags == 'success' %}
                            showNotification('{{ message }}', 'success');
                        {% elif message.tags == 'error' %}
                            showNotification('{{ message }}', 'error');
                        {% endif %}
                    {% endfor %}
                {% endif %}

                // Handle country change
                $('#country-select').change(function() {
                    var countryId = $(this).val();
                    if (countryId) {
                        $.ajax({
                            url: "{% url 'get_states' %}",
                            data: {
                                'country_id': countryId
                            },
                            success: function(data) {
                                $('#state-select').empty();
                                $('#state-select').append('<option value="">Select Your State</option>');
                                $.each(data, function(index, state) {
                                    $('#state-select').append('<option value="' + state.id + '">' + state.name + '</option>');
                                });
                            }
                        });
                    } else {
                        $('#state-select').empty();
                        $('#state-select').append('<option value="">Select Your State</option>');
                    }
                });
            });

            function showNotification(message, type) {
                var alertDiv = $('#message-alerts');
                var alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
                
                alertDiv.html('<div class="alert ' + alertClass + ' alert-dismissible fade show" role="alert">' +
                            message +
                            '<button type="button" class="close" data-dismiss="alert" aria-label="Close">' +
                            '<span aria-hidden="true">&times;</span>' +
                            '</button></div>').show();
                
                // Auto-hide after 5 seconds
                setTimeout(function() {
                    alertDiv.fadeOut();
                }, 5000);
            }
        </script>

        <form method="POST" onsubmit="return checkform()" name="regform" id="regform">
            {% csrf_token %}
            
            <table width="100%" border="0" cellspacing="0">
                <tbody>
                    <tr>
                        <th>
                            <h2>Account Information</h2>
                        </th>
                    </tr>
                    
                    <!-- Personal Information -->
                    <tr>
                        <td>
                            <div class="form-group">
                                <input type="text" name="first_name" class="form-control" placeholder="Your First Name" value="{{ form.first_name.value|default:'' }}" required>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="form-group">
                                <input type="text" name="last_name" class="form-control" placeholder="Your Last Name" value="{{ form.last_name.value|default:'' }}" required>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="form-group">
                                <input type="text" name="username" class="form-control" placeholder="Your User Name" value="{{ form.username.value|default:'' }}" required>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="form-group">
                                <input type="email" name="email" class="form-control" placeholder="Your E-mail Address" value="{{ form.email.value|default:'' }}" required>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Location Information -->
                    <tr>
                        <td>
                            <div class="form-group">
                                <select name="country" id="country-select" class="form-control" required>
                                    <option value="">Select Your Country</option>
                                    {% for country in form.country.field.queryset %}
                                        <option value="{{ country.id }}" {% if form.country.value == country.id %}selected{% endif %}>{{ country.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="form-group">
                                <select name="state" id="state-select" class="form-control" required>
                                    <option value="">Select Your State</option>
                                    {% if form.state.value %}
                                        {% for state in form.state.field.queryset %}
                                            <option value="{{ state.id }}" {% if form.state.value == state.id %}selected{% endif %}>{{ state.name }}</option>
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Currency Selection -->
                    <tr>
                        <td>
                            <div class="form-group">
                                <select name="currency_type" class="form-control" required>
                                    <option value="">Select Preferred Currency</option>
                                    {% for value, label in form.currency_type.field.choices %}
                                        {% if value %}
                                            <option value="{{ value }}" {% if form.currency_type.value == value %}selected{% endif %}>{{ label }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Security Information -->
                    <tr>
                        <td>
                            <div class="form-group">
                                <input type="password" name="password" class="form-control" placeholder="Define Password" required>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="form-group">
                                <input type="password" name="password_confirm" class="form-control" placeholder="Retype Password" required>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Contact Information -->
                    <tr>
                        <td>
                            <div class="form-group">
                                <input type="text" name="phone_no" class="form-control" placeholder="Phone Number (Optional)" value="{{ form.phone_no.value|default:'' }}">
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Terms Agreement -->
                    <tr>
                        <td align="center" valign="middle">
                            <div class="form-check">
                                <input type="checkbox" name="agree_terms" class="form-check-input" id="agree_terms" required>
                                <label class="form-check-label" for="agree_terms">
                                    I agree with <a href="{% url 'terms' %}" target="_blank">Terms and conditions</a>
                                </label>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Submit Button -->
                    <tr>
                        <td align="center" valign="middle">
                            <input type="submit" value="Register" class="sbmt">
                        </td>
                    </tr>
                    
                    <!-- Login Link -->
                    <tr>
                        <td align="center" valign="middle" style="padding-top: 20px;">
                            <p>Already have an account? <a href="{% url 'login' %}">Login here</a></p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </form>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script src="/static/assets/js/jquery-3.2.1.min.js"></script>
<script src="/static/assets/js/cubeb86a.js"></script>
<script src="/static/assets/js/1fonjd21.js"></script>
{% endblock %}